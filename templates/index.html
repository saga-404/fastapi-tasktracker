<!doctype html>
<html>
<head><meta charset="utf-8"><title>Task & Time Tracker</title></head>
<body>
  <h1>Task & Time Tracker</h1>
  <form id="f">
    <input name="title" placeholder="title" required>
    <input name="memo" placeholder="memo">
    <button type="submit">Add</button>
  </form>
  <ul id="list"></ul>

  <script>
    async function refresh(){
      const res = await fetch('/tasks');
      const items = await res.json();
      document.getElementById('list').innerHTML =
        items.map(t=>`
            <li>
                <label>
                    <input type="checkbox" ${t.is_done ? 'cheked' : ''} onchange="toggleDone(${t.id}, this.checked)">
                    <span style ="${t.is_done ? 'text-decoration: line-through; color:#888;' : ''}">
                    ${t.id}: ${t.title}: ${t.memo}
                    </span>
                </label>
            </li>
        `).join('');
    }

    async function toggleDone(id, checked){
        await fetch('/tasks/'+id+'/done?done='+(checked ? 'true' : 'false'), {method:'PUT'});
        refresh();
    }
    document.getElementById('f').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const fd = new FormData(e.target);
      await fetch('/tasks', {method:'POST', headers:{'Content-Type':'application/json'},
        body: JSON.stringify({title: fd.get('title'), memo: fd.get('memo')})});
      e.target.reset(); refresh();
    });
    refresh();
  </script>
</body>
</html>
